### Auth

### Driver Auth
### POST /api/auth/driver/start → { request_id }
POST http://localhost:3459/api/auth/driver/start
Content-Type: application/json

{
  "phoneNumber": "+256700000018"
}

### POST /api/auth/driver/verify → { token, role: 'driver', user }

POST http://localhost:3459/api/auth/driver/verify
Content-Type: application/json

{
  "request_id": "68bdc99f4255bafaa9fb9c09",
   "code": "151389"
}

### Buyer Auth
### POST /api/auth/{driver|farmer|buyer}/login → { token, role, user }
POST http://localhost:3459/api/auth/farmer/login
Content-Type: application/json

{
  "email": "farmer001@fty.com",
  "password": "farmer123"
}


### Farmer Auth
### email:buyer001@fty.com password: buyer123
### eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VlNjkyMjY0NzkzYTY5YjE0OTEiLCJyb2xlIjoiYnV5ZXIiLCJzdWJNb2RlbCI6IlVzZXIiLCJpYXQiOjE3NTcyNTk2NzAsImV4cCI6MTc1OTg1MTY3MH0.vZz8QFJDVT0pOuAU6XFxJue1fQZV_Rh0Qnhhv3NLVCI
POST http://localhost:3459/api/auth/buyer/login
Content-Type: application/json

{
  "email": "buyer001@buyers.fty.com",
  "password": "buyer123"
}

###

### Admin Auth


### Password Reset
######## POST /api/auth/password/reset → { message }
######## POST /api/auth/password/forgot → { message }

### Farmer Routes
##### Farmer create lot
#### eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VhNjkyMjY0NzkzYTY5YjE0NDEiLCJyb2xlIjoiZmFybWVyIiwic3ViTW9kZWwiOiJVc2VyIiwiaWF0IjoxNzU3MjYxMjUyLCJleHAiOjE3NTk4NTMyNTJ9.PN_JaLfi1rmkDMxtr_QpfQNDsrgdB2o48EXzulgM51k
### POST /api/products/lots

POST http://localhost:3459/api/products/lots
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VhNjkyMjY0NzkzYTY5YjE0NDEiLCJyb2xlIjoiZmFybWVyIiwic3ViTW9kZWwiOiJVc2VyIiwiaWF0IjoxNzU3MjYxMjUyLCJleHAiOjE3NTk4NTMyNTJ9.PN_JaLfi1rmkDMxtr_QpfQNDsrgdB2o48EXzulgM51k

{
  "produceType": "Eggs",
  "description": "local chicken eggs.",
  "quantity": 300,
  "reservePrice": 12000,
  "unit": "Trays",
  "pickup": {
    "name": "Berna's Farm",
    "address": "123 West Lake, Countryside",
    "lat": 34.0522,
    "lng": -118.2437
  }
}

##### Farmer get lots

##### GET /api/products/lots

GET http://localhost:3459/api/products/lots/open
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VhNjkyMjY0NzkzYTY5YjE0NDEiLCJyb2xlIjoiZmFybWVyIiwic3ViTW9kZWwiOiJVc2VyIiwiaWF0IjoxNzU3MjYxMjUyLCJleHAiOjE3NTk4NTMyNTJ9.PN_JaLfi1rmkDMxtr_QpfQNDsrgdB2o48EXzulgM51k


##### GET /api/products/lots?status=open

##### Farmer get lot by id
##### Farmer update lot
##### Farmer delete lot

##### Buyer bids on lot
#### POST /api/products/lots/{lotId}/bids
##### eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VlNjkyMjY0NzkzYTY5YjE0OTEiLCJyb2xlIjoiYnV5ZXIiLCJzdWJNb2RlbCI6IlVzZXIiLCJpYXQiOjE3NTcyNTk2NzAsImV4cCI6MTc1OTg1MTY3MH0.vZz8QFJDVT0pOuAU6XFxJue1fQZV_Rh0Qnhhv3NLVCI
##### bid id 68bf83a1705cd645f082a386
POST http://localhost:3459/api/products/lots/68bfa157d7fc6e53a0124684/bids
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VlNjkyMjY0NzkzYTY5YjE0OTEiLCJyb2xlIjoiYnV5ZXIiLCJzdWJNb2RlbCI6IlVzZXIiLCJpYXQiOjE3NTcyNTk2NzAsImV4cCI6MTc1OTg1MTY3MH0.vZz8QFJDVT0pOuAU6XFxJue1fQZV_Rh0Qnhhv3NLVCI
Content-Type: application/json

{
  "amount": 360000,
  "note": "Looking forward to these local Eggs!",
  "quantity": 340,
  "units":"Trays"
}

##### Farmer gets bids on lot
##### GET /api/products/lots/{lotId}/bids
GET http://localhost:3459/api/products/lots/68bfa157d7fc6e53a0124684/bids
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VhNjkyMjY0NzkzYTY5YjE0NDEiLCJyb2xlIjoiZmFybWVyIiwic3ViTW9kZWwiOiJVc2VyIiwiaWF0IjoxNzU3MjYxMjUyLCJleHAiOjE3NTk4NTMyNTJ9.PN_JaLfi1rmkDMxtr_QpfQNDsrgdB2o48EXzulgM51k

##### Farmer accepts bid on lot
##### POST /api/products/lots/{lotId}/bids/{bidId}/accept
POST http://localhost:3459/api/products/lots/68bfa157d7fc6e53a0124684/bids/68bfa278a5831c4eb868ebd3/accept
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VhNjkyMjY0NzkzYTY5YjE0NDEiLCJyb2xlIjoiZmFybWVyIiwic3ViTW9kZWwiOiJVc2VyIiwiaWF0IjoxNzU3MjgxMzg2LCJleHAiOjE3NTk4NzMzODZ9.dba1wOVwSALfYuEuX7HMC_9fFFuCmi3-Q5X0-pxE1eQ

##### (PaymentIntent type=product, status=authorized)
##### Farmer rejects bid on lot
##### Farmer gets all accepted bids
##### Farmer gets all rejected bids
##### Farmer gets all bids

#### Buyer payments for accepted bids
#####  create Delivery Request prefilled with pickup location (farmer address) and dropoff location (buyer address)


### Buyer -> Driver (Delivery) Bidding
#### eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjNmE5MDIzMTU2Mzg5NzFmZmRjNzciLCJyb2xlIjoiZHJpdmVyIiwic3ViTW9kZWwiOiJEcml2ZXIiLCJpYXQiOjE3NTcyNjg1NTYsImV4cCI6MTc1OTg2MDU1Nn0.HB1bRnepOLHny8MYpHJyaQeQysrdOmzovx3B0GhirXQ
##### Driver gets all delivery requests
##### GET /api/driver/requests/open?nearLat=&nearLng=&within_km=50
GET http://localhost:3459/api/driver/requests/open?nearLat=&nearLng=&within_km=50
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjNmE5MDIzMTU2Mzg5NzFmZmRjNzciLCJyb2xlIjoiZHJpdmVyIiwic3ViTW9kZWwiOiJEcml2ZXIiLCJpYXQiOjE3NTcyNjg1NTYsImV4cCI6MTc1OTg2MDU1Nn0.HB1bRnepOLHny8MYpHJyaQeQysrdOmzovx3B0GhirXQ

##### Driver places bid (quoute) on delivery request
##### POST /api/driver/requests/{id}/quote
POST http://localhost:3459/api/driver/requests/68bfa2dfa5831c4eb868ebe1/quote
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjNmE5MDIzMTU2Mzg5NzFmZmRjNzciLCJyb2xlIjoiZHJpdmVyIiwic3ViTW9kZWwiOiJEcml2ZXIiLCJpYXQiOjE3NTcyNjg1NTYsImV4cCI6MTc1OTg2MDU1Nn0.HB1bRnepOLHny8MYpHJyaQeQysrdOmzovx3B0GhirXQ

{
  "amount":25000,
  "etaMinutes": 20,
  "note":"I can transport Eggs"
}

##### Buyer gets all bids on delivery request
##### Buyer accepts bid on delivery request
##### POST /api/buyer/requests/{id}/quotes/{quoteId}/accept
##### Creates DriverJob with codes (farmerCode, buyerCode) and status=awaiting_driver_confirm.
POST http://localhost:3459/api/buyer/requests/68bfa2dfa5831c4eb868ebe1/quotes/68bfa398a5831c4eb868ebe9/accept
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VlNjkyMjY0NzkzYTY5YjE0OTEiLCJyb2xlIjoiYnV5ZXIiLCJzdWJNb2RlbCI6IlVzZXIiLCJpYXQiOjE3NTcyNTk2NzAsImV4cCI6MTc1OTg1MTY3MH0.vZz8QFJDVT0pOuAU6XFxJue1fQZV_Rh0Qnhhv3NLVCI

##### PaymentIntent type=transport, status=authorized
##### Buyer rejects bid on delivery request
##### Buyer authorizes payment for delivery (escrow)
##### Driver confirms the bid and starts delivery (job)-> active
##### POST /api/driver/requests/quotes/{quoteId}/confirm → job active
POST http://localhost:3459/api/driver/requests/quotes/68bfa398a5831c4eb868ebe9/confirm
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjNmE5MDIzMTU2Mzg5NzFmZmRjNzciLCJyb2xlIjoiZHJpdmVyIiwic3ViTW9kZWwiOiJEcml2ZXIiLCJpYXQiOjE3NTcyNjg1NTYsImV4cCI6MTc1OTg2MDU1Nn0.HB1bRnepOLHny8MYpHJyaQeQysrdOmzovx3B0GhirXQ


####### 


### Pickup -> Deliver (Escrow) Releases
##### Pickup at farmer location -> Driver confirms pickup (Enters farmer code)-> Escrow payment for delivery is released to driver
##### POST /api/driver/jobs/{jobId}/pickup-confirm
POST http://localhost:3459/api/driver/jobs/68bfa3bea5831c4eb868ebf1/pickup-confirm
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjNmE5MDIzMTU2Mzg5NzFmZmRjNzciLCJyb2xlIjoiZHJpdmVyIiwic3ViTW9kZWwiOiJEcml2ZXIiLCJpYXQiOjE3NTcyNjg1NTYsImV4cCI6MTc1OTg2MDU1Nn0.HB1bRnepOLHny8MYpHJyaQeQysrdOmzovx3B0GhirXQ

{
  "code": "1670"
}

######## Driver confirms delivery (Enters buyer code) -> Escrow payment for delivery is released to driver
##### POST /api/driver/jobs/{jobId}/delivery-confirm
POST http://localhost:3459/api/driver/jobs/68bfa3bea5831c4eb868ebf1/delivery-confirm
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjNmE5MDIzMTU2Mzg5NzFmZmRjNzciLCJyb2xlIjoiZHJpdmVyIiwic3ViTW9kZWwiOiJEcml2ZXIiLCJpYXQiOjE3NTcyNjg1NTYsImV4cCI6MTc1OTg2MDU1Nn0.HB1bRnepOLHny8MYpHJyaQeQysrdOmzovx3B0GhirXQ

{
  "code": "5781"
}

##### Delivery at buyer location -> Buyer confirms delivery (Enters driver code) -> Escrow payment for lot is released to farmer
### POST /api/payments/jobs/{jobId}/release-nfc