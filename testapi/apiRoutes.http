### Auth

### Driver Auth
### POST /api/auth/driver/start → { request_id }
POST http://localhost:3459/api/auth/driver/start
Content-Type: application/json

{
  "phoneNumber": "+256700000018"
}

### POST /api/auth/driver/verify → { token, role: 'driver', user }

POST http://localhost:3459/api/auth/driver/verify
Content-Type: application/json

{
  "request_id": "68bdc99f4255bafaa9fb9c09",
   "code": "151389"
}

### Buyer Auth
### POST /api/auth/{driver|farmer|buyer}/login → { token, role, user }
POST http://localhost:3459/api/auth/farmer/login
Content-Type: application/json

{
  "email": "farmer001@fty.com",
  "password": "farmer123"
}


### Farmer Auth
### email:buyer001@fty.com password: buyer123
### eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VlNjkyMjY0NzkzYTY5YjE0OTEiLCJyb2xlIjoiYnV5ZXIiLCJzdWJNb2RlbCI6IlVzZXIiLCJpYXQiOjE3NTcyNTk2NzAsImV4cCI6MTc1OTg1MTY3MH0.vZz8QFJDVT0pOuAU6XFxJue1fQZV_Rh0Qnhhv3NLVCI
POST http://localhost:3459/api/auth/buyer/login
Content-Type: application/json

{
  "email": "buyer001@buyers.fty.com",
  "password": "buyer123"
}

###

### Admin Auth


### Password Reset
######## POST /api/auth/password/reset → { message }
######## POST /api/auth/password/forgot → { message }

### Farmer Routes
##### Farmer create lot
#### eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VhNjkyMjY0NzkzYTY5YjE0NDEiLCJyb2xlIjoiZmFybWVyIiwic3ViTW9kZWwiOiJVc2VyIiwiaWF0IjoxNzU3MjYxMjUyLCJleHAiOjE3NTk4NTMyNTJ9.PN_JaLfi1rmkDMxtr_QpfQNDsrgdB2o48EXzulgM51k
### POST /api/products/lots

POST http://localhost:3459/api/products/lots
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VhNjkyMjY0NzkzYTY5YjE0NDEiLCJyb2xlIjoiZmFybWVyIiwic3ViTW9kZWwiOiJVc2VyIiwiaWF0IjoxNzU3MjYxMjUyLCJleHAiOjE3NTk4NTMyNTJ9.PN_JaLfi1rmkDMxtr_QpfQNDsrgdB2o48EXzulgM51k

{
  "produceType": "Fresh Apples",
  "description": "Crisp and juicy apples from our orchard.",
  "quantity": 100,
  "reservePrice": 2.5,
  "unit": "Kg",
  "pickup": {
    "name": "John's Farm",
    "address": "123 Farm Lane, Countryside",
    "lat": 34.0522,
    "lng": -118.2437
  }
}

##### Farmer get lots

##### GET /api/products/lots

GET http://localhost:3459/api/products/lots/open
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VhNjkyMjY0NzkzYTY5YjE0NDEiLCJyb2xlIjoiZmFybWVyIiwic3ViTW9kZWwiOiJVc2VyIiwiaWF0IjoxNzU3MjYxMjUyLCJleHAiOjE3NTk4NTMyNTJ9.PN_JaLfi1rmkDMxtr_QpfQNDsrgdB2o48EXzulgM51k


##### GET /api/products/lots?status=open

##### Farmer get lot by id
##### Farmer update lot
##### Farmer delete lot

##### Buyer bids on lot
#### POST /api/products/lots/{lotId}/bids
##### eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VlNjkyMjY0NzkzYTY5YjE0OTEiLCJyb2xlIjoiYnV5ZXIiLCJzdWJNb2RlbCI6IlVzZXIiLCJpYXQiOjE3NTcyNTk2NzAsImV4cCI6MTc1OTg1MTY3MH0.vZz8QFJDVT0pOuAU6XFxJue1fQZV_Rh0Qnhhv3NLVCI
POST http://localhost:3459/api/products/lots/68bda287e1857517bdd670f8/bids
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VlNjkyMjY0NzkzYTY5YjE0OTEiLCJyb2xlIjoiYnV5ZXIiLCJzdWJNb2RlbCI6IlVzZXIiLCJpYXQiOjE3NTcyNTk2NzAsImV4cCI6MTc1OTg1MTY3MH0.vZz8QFJDVT0pOuAU6XFxJue1fQZV_Rh0Qnhhv3NLVCI
Content-Type: application/json

{
  "amount": 25,
  "note": "Looking forward to these apples!"
}

##### Farmer gets bids on lot
##### GET /api/products/lots/{lotId}/bids
GET http://localhost:3459/api/products/lots/68bda287e1857517bdd670f8/bids
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VhNjkyMjY0NzkzYTY5YjE0NDEiLCJyb2xlIjoiZmFybWVyIiwic3ViTW9kZWwiOiJVc2VyIiwiaWF0IjoxNzU3MjYxMjUyLCJleHAiOjE3NTk4NTMyNTJ9.PN_JaLfi1rmkDMxtr_QpfQNDsrgdB2o48EXzulgM51k

##### Farmer accepts bid on lot
##### POST /api/products/lots/{lotId}/bids/{bidId}/accept
POST http://localhost:3459/api/products/lots/68bda287e1857517bdd670f8/bids/68bda8c605b26abfdb94d7d8/accept
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjM2VhNjkyMjY0NzkzYTY5YjE0NDEiLCJyb2xlIjoiZmFybWVyIiwic3ViTW9kZWwiOiJVc2VyIiwiaWF0IjoxNzU3MjYxMjUyLCJleHAiOjE3NTk4NTMyNTJ9.PN_JaLfi1rmkDMxtr_QpfQNDsrgdB2o48EXzulgM51k

##### (PaymentIntent type=product, status=authorized)
##### Farmer rejects bid on lot
##### Farmer gets all accepted bids
##### Farmer gets all rejected bids
##### Farmer gets all bids

#### Buyer payments for accepted bids
#####  create Delivery Request prefilled with pickup location (farmer address) and dropoff location (buyer address)


### Buyer -> Driver (Delivery) Bidding
#### eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjNmE5MDIzMTU2Mzg5NzFmZmRjNzciLCJyb2xlIjoiZHJpdmVyIiwic3ViTW9kZWwiOiJEcml2ZXIiLCJpYXQiOjE3NTcyNjg1NTYsImV4cCI6MTc1OTg2MDU1Nn0.HB1bRnepOLHny8MYpHJyaQeQysrdOmzovx3B0GhirXQ
##### Driver gets all delivery requests
##### GET /api/driver/requests/open?nearLat=&nearLng=&within_km=50
GET http://localhost:3459/api/driver/requests/open?nearLat=&nearLng=&within_km=50
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjNmE5MDIzMTU2Mzg5NzFmZmRjNzciLCJyb2xlIjoiZHJpdmVyIiwic3ViTW9kZWwiOiJEcml2ZXIiLCJpYXQiOjE3NTcyNjg1NTYsImV4cCI6MTc1OTg2MDU1Nn0.HB1bRnepOLHny8MYpHJyaQeQysrdOmzovx3B0GhirXQ

##### Driver places bid (quoute) on delivery request
##### POST /api/driver/requests/{id}/quote
POST http://localhost:3459/api/driver/requests/68bdd0060e86a0c54fc374da/quote
Content-Type: application/json
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2OGJjNmE5MDIzMTU2Mzg5NzFmZmRjNzciLCJyb2xlIjoiZHJpdmVyIiwic3ViTW9kZWwiOiJEcml2ZXIiLCJpYXQiOjE3NTcyNjg1NTYsImV4cCI6MTc1OTg2MDU1Nn0.HB1bRnepOLHny8MYpHJyaQeQysrdOmzovx3B0GhirXQ

{
  "amount":34000,
  "etaMinutes": 546,
  "note":"I can transport apples"
}

##### Buyer gets all bids on delivery request
##### Buyer accepts bid on delivery request
##### POST /api/buyer/requests/{id}/quotes/{quoteId}/accept

##### Creates DriverJob with codes (farmerCode, buyerCode) and status=awaiting_driver_confirm.
##### PaymentIntent type=transport, status=authorized
##### Buyer rejects bid on delivery request
##### Buyer authorizes payment for delivery (escrow)
##### Driver confirms the bid and starts delivery (job)-> active
##### POST /api/driver/requests/quotes/{quoteId}/confirm → job active
####### 


### Pickup -> Deliver (Escrow) Releases
##### Pickup at farmer location -> Driver confirms pickup (Enters farmer code)-> Escrow payment for delivery is released to driver
##### POST /api/driver/jobs/{jobId}/delivery-confirm
######## Driver confirms delivery (Enters buyer code) -> Escrow payment for delivery is released to driver
##### Delivery at buyer location -> Buyer confirms delivery (Enters driver code) -> Escrow payment for lot is released to farmer

### POST /api/payments/jobs/{jobId}/release-nfc